# PgRoutiner

.NET Core tool for easy scaffolding of PostgreSQL routines.

Make your .NET Core project do a static type checking on your PostgreSQL.

It will generate for your source code files for:

- data-access classes as `NpgsqlConnection` object extension - for all of your PostgreSQL routines (function and/or procedures)

- all related models that routine may return as result (record of physical table)

You can use this tool to enforce **static type checking** over PostgreSQL programable routines in your .net core project.

## Installation

```
dotnet tool install --global PgRoutiner
```

## Running

`PgRoutiner` tool is implemented as a command line tool. 

It is enough to just type `PgRoutiner` and it will look for .net core project file (.csproj) in current directory and start source file generation by using first available connection string in your configuration.

You may supply additional configuration settings trough :

- Custom json configuration section `PgRoutiner`. For example:

```json
{
  "PgRoutiner": {
    "Connection": "MyConnection",
  }
}
```

- Command line parameters. For example:

```
PgRoutiner Connection=MyConnection
```

Command line will always override json configuration settings.

## Configuration

| Name | Description | Default |
| ---- | ----------- | ------- |
| Connection | Connection string name from your configuration connection string to be used. | First available connection string. |
| Project | Path to project .csproj file. | First available .csproj file from current dir. |
| OutputDir | Path to generated source files output dir. | Current dir. |
| ModelDir | Path to dir where model classes source files will be generated. | Default generates model classes in same source file as data-access code. Set this path to change this behavior. |
| Schema |  |  |
| Overwrite |  |  |
| Namespace |  |  |
| NotSimilarTo |  |  |
| SourceHeader |  |  |
| SyncMethod |  |  |
| AsyncMethod |  |  |
| Mapping |  |  |

## Simple example

- PostgreSQL Function that returns `bigint` number:

```sql
create function calculate_some_number(_input_param bigint) returns bigint as
$$
begin
    -- calculate the number
    return _result;
end
$$
language plpgsql;
```

Running `PgRoutiner` tool will generate following source code:

```csharp
// <auto-generated at 2020-06-12T18:53:28.2799640+02:00 />
using System;
using System.Linq;
using System.Collections.Generic;
using System.Threading.Tasks;
using Norm.Extensions;
using Npgsql;

namespace PgRoutiner.Test
{
    public static class PgRoutineCalculateSomeNumber
    {
        public const string Name = "calculate_some_number";

        /// <summary>
        /// sql function "calculate_some_number"
        /// description for calculate_some_number
        /// </summary>
        public static long CalculateSomeNumber(this NpgsqlConnection connection, long inputParam)
        {
            return connection
                .Single<long>(Name, ("_input_param", inputParam));
        }

        /// <summary>
        /// sql function "calculate_some_number"
        /// description for calculate_some_number
        /// </summary>
        public static async ValueTask<long> CalculateSomeNumberAsync(this NpgsqlConnection connection, long inputParam)
        {
            return await connection
                .SingleAsync<long>(Name, ("_input_param", inputParam));
        }
    }
}
```

For more examples go to this page...


